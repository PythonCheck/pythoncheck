{{ if request.function == 'edit' and request.args(1) == 'edit_exercise': }}
	{{
	form = SQLFORM(db.course_exercise, db.course_exercise(request.args(2)), fields=['exercise', 'start_date', 'end_date'])
	if form.process().accepted:
		session.flash = 'Changed Exercise'
		redirect(URL(request.function + '/' + request.args(0)))
	pass
	}}
	{{= form }}
{{ else: }}
	{{ if request.function == 'edit' and request.args(1) == 'add_exercise': }}
		{{
		def validate_exercise(form):
			form.vars.course = request.args(0)
		pass

		new_exercise = SQLFORM(db.course_exercise, fields=['exercise', 'start_date', 'end_date'])
		if new_exercise.accepts(request.vars, session, onvalidation=validate_exercise):
			session.flash = 'Added Exercise'
			redirect(URL(request.function + '/' + request.args(0)))
		pass
		}}
		{{= new_exercise }}
	{{ elif request.function == 'edit': }}
		<a class="w2p_trap button btn" href="/{{= request.application }}/{{= request.controller }}/{{= request.function }}/{{= request.args(0) }}/add_exercise">
			<span class="icon plus icon-plus"></span>
			<span class="buttontext button" title="{{=T('Add')}}">{{=T('Add')}}</span>
		</a>
	{{ pass }}

	{{ if len(exercises) > 0: }}
		<table>
			<thead>
				<tr>
					<th>{{= T('#') }}</th>
					<th>{{= T('Exercise') }}</th>
					<th>{{= T('Start Date') }}</th>
					<th>{{= T('End Date') }}</th>
					<th>{{= T('Description') }}</th>
				{{ if request.function == 'edit': }}
					<td></td>
				{{ pass }}
				</tr>
			</thead>
			<tbody>
			{{ n = 0 }}
			{{ for row in exercises: }}
				{{ n += 1 }}
				<tr>
					<td>{{= n }}</td>
					<td>{{= row.exercise.name }}</td>
					<td>{{= row.start_date }}</td>
					<td>{{= row.end_date }}</td>
					<td>{{= row.exercise.text }}</td>
				{{ if request.function == 'edit': }}
					<td>
						<a class="w2p_trap button btn" href="/{{= request.application }}/{{= request.controller }}/{{= request.function }}/{{= request.args(0) }}/edit_exercise/{{= row.id }}">
							<span class="icon pen icon-pencil"></span>
							<span class="buttontext button" title="{{= T('Edit') }}">{{= T('Edit') }}</span>
						</a>
					</td>
				{{ pass }}
				</tr>
			{{ pass }}
			</tbody>
		</table>
	{{ else: }}
		<p><em>{{= T('No exercises in this course') }}</em></p>
	{{ pass }}

{{ pass }}